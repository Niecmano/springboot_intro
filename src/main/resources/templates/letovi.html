<!DOCTYPE html>
<html lang="sr">
    <head>
        <meta charset="UTF-8">
        <title>myTravel letovi</title>
        <link rel="stylesheet" href="/css/style.css">
    </head>
    <body>

        <div class="wrapper">

            <div class="gore">

                <div>
                    <img src="/images/mytravel.png" height="80vh" />
                </div>

                <div class="nutzer">
                        <a href="/letovi">Poƒçetna</a>
                        <a href="/register">Registracija</a>
                        <a href="/login">Prijava</a>

                </div>

            </div>

            <div class="letovi">
                <div class="izbor">
                    <div>
                        <label for="tfod" class="infizb">Letimo od:</label>
                        <input list="options" id="tfod" name="od" placeholder="Unesite grad...">
                    </div>

                    <div>
                        <label for="tfdo" class="infizb">Destinacija:</label>
                        <input list="options" id="tfdo" name="do" placeholder="Unesite grad...">
                    </div>

                    <datalist id="options">
                    </datalist>
                    <button onclick="pretraga()">Pretrazi letove</button>
                </div>
                <ul id="output">
                </ul>
            </div>

        </div>


        <script>
            document.addEventListener("DOMContentLoaded", () => {
                vratiGradove();
            });
            function formatirajVreme(vreme) {
                const d = new Date(vreme);
                return d.toLocaleString("sr-RS");
            }

            function vratiGradove() {
                fetch("/api/gradovi")
                        .then(res => res.json())
                        .then(data => {
                            const datalist = document.getElementById("options");

                            data.forEach(g => {
                                const option = document.createElement("option");
                                option.value = g.naziv;
                                datalist.appendChild(option);
                            });
                        });
            }
            function pretraga() {
                const iz = document.getElementById("tfod").value;
                const ka = document.getElementById("tfdo").value;

                if (!iz || !ka) {
                    alert("Morate uneti oba grada");
                    return;
                }

                fetch(`/api/letovi/filter?iz=${encodeURIComponent(iz)}&ka=${encodeURIComponent(ka)}`)
                        .then(res => res.json())
                        .then(data => prikaziLetove(data));
            }

            function prikaziLetove(letovi) {
                const ul = document.getElementById("output");
                ul.innerHTML = "";

                letovi.forEach(l => {
                    const li = document.createElement("li");

                    const spanRelacija = document.createElement("span");
                    spanRelacija.textContent = `${l.iz.naziv} - ${l.ka.naziv}`;

                    const spanVreme = document.createElement("span");
                    spanVreme.style.marginLeft = "10px";
                    spanVreme.textContent = formatirajVreme(l.vreme);
                    
                    li.appendChild(spanRelacija);
                    li.appendChild(spanVreme);

                    ul.appendChild(li);
                });
            }
        </script>

    </body>
</html>